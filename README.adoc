= Design Patterns - TD4
J.-M. Bruel <jbruel@gmail.com>
v20.1 {localdate}
:tdnum: TD4
:uk!:
:imagesdir: images
//------------------------- variables de configuration
// only used when master document
:icons: font
:experimental:
:numbered!:
:status:
:source-highlighter: rouge
:baseURL: :baseURL: http://bit.ly/innopolis-patterns
:github: https://github.com[GitHub]
// Specific to GitHub
ifdef::env-github[]
:tip-caption: :bulb:
:note-caption: :information_source:
:important-caption: :heavy_exclamation_mark:
:caution-caption: :fire:
:warning-caption: :warning:

endif::[]
//------------------------------------ 
ifdef::uk[]
:lang: uk
:lastName: LAST NAME
:firstName: First Name
:group: Group
:example: Example
:Enseignants: Teachers
:principe: Good design principle
:assignment: Assignment info
:requirements: Requirements
:initial: Initial tasks
:allerPlusLoin: Still hungry?...
:about: About...
:contrib: Contributors
endif::[]
ifndef::uk[]
:lang: fr
:lastName: NOM
:firstName: Prénom
:group: Groupe
:example: Exemple
:Enseignants: Enseignants
:principe: Principe Objet
:assignment: Informations générales
:requirements: Pré-requis
:initial: Tâche initiale
:allerPlusLoin: Pour Aller plus loin...
:about: À propos...
:contrib: Contributeurs
endif::[]
:java: https://www.java.com/fr/[Java]
:asciidoc: http://www.methods.co.nz/asciidoc[AsciiDoc]indexterm:[AsciiDoc]
:asciidoctorlink: http://asciidoctor.org/[Asciidoctor]indexterm:[Asciidoctor]
//------------------------------------ 

ifdef::uk[]
== {tdnum} initial code
This is a template for the students' assignments.

ifndef::backend-pdf[]
TIP: Course material: pass:[<i class="fa fa-mobile"></i> <i class="fa fa-tablet"></i> <i class="fa fa-laptop"></i>] http://bit.ly/jmb-cpoa
endif::[]

ifdef::backend-pdf[]
TIP: Course material: icon:mobile[] icon:tablet[] icon:laptop[] http://bit.ly/jmb-cpoa
endif::[]
endif::[]

ifndef::uk[]
== Code initial pour le {tdnum}

ifndef::backend-pdf[]
TIP: Rappel du cours : pass:[<i class="fa fa-mobile"></i> <i class="fa fa-tablet"></i> <i class="fa fa-laptop"></i>] http://bit.ly/jmb-cpoa
endif::[]

ifdef::backend-pdf[]
TIP: Rappel du cours : icon:mobile[] icon:tablet[] icon:laptop[] http://bit.ly/jmb-cpoa
endif::[]

endif::[]

//------------------------------------ 
== {assignment}

{lastName}:: BRUEL

{firstName}:: Jean-Michel

{group} #::

[%interactive]
- [x] {Enseignants}
- [ ] 1
- [ ] 2
- [ ] 3
- [ ] 4
- [ ] Innopolis

//------------------------------------ 
== {requirements}

ifdef::uk[]
You'll need:

[%interactive]
* [x] A {Github} account  
* [ ] A https://gitforwindows.org/[Git Bash] terminal (if you use Window$)
endif::[]
ifndef::uk[]
Il vous faut :

[%interactive]
* [x] Un compte {Github}  
* [ ] Un terminal de type https://gitforwindows.org/[Git Bash]  (si vous utilisez Window$)
endif::[]

ifdef::uk[]
[TIP]
====    
Try the following command in your terminal to check your `git` environment:
endif::[]
ifndef::uk[]
[TIP]
====    
Essayez la commande suivante dans votre terminal pour vérifier votre environnement `git` :
endif::[]

[source,shell]
....
git config --global -l
....
====

//------------------------------------ 
== {initial}

ifdef::uk[]
[%interactive]
* [x] Click on the Github Classroom link provided by your teacher (in fact, this should be done if you read this).
* [ ] Clone on your machine the Github project generated by Github Classroom.  
* [ ] Modify the README file to add your last name, first name and group number. 
* [ ] Commit and push using the following message:
endif::[]
ifndef::uk[]
[%interactive]
* [x] Clickez sur le lien Github Classroom fourni par votre enseignant (en fait c'est déjà fait si vous lisez ces lignes).
* [ ] Clonez sur votre machine le projet Github généré pour vous par Github Classroom.  
* [ ] Modifez le `README` pour modifier Nom, Prénom et Groupe. 
* [ ] Commit & push:
endif::[]

ifndef::backend-pdf[.pass:[<i class="fa fa-github"></i>] commit/push]
ifdef::backend-pdf[.icon:github[] commit/push]
[source,shell]
....
fix #0 Initial task done
....

[IMPORTANT]
ifndef::uk[]
Dans la suite de ce document, à chaque fois que vous trouverez un énoncé commençant par `fix #...` vous devez vérifier que vos scripts/fichiers modifiés sont bien dans votre dépôt local en vue de committer et de pusher les modifications sur votre dépôt distant en utilisant comme message de commit cet énoncé.

[TIP]
====
- Si vous voulez vérifier que vous êtes prêt pour le `fix #0`, utilisez la commande : `make check`.
- Si vous voulez avoir la liste des ToDos de ce TP/TP, exécutez `make todos`.
====

[NOTE]
=====
Les exercices de ce TD sont tirés de l'excellent livre "Tête la première : Design Pattern".
Bert Bates, Eric Freeman, Elisabeth Freeman, Kathy Sierra. Editions O'Reilly. 2005.

image::headFirst.jpg[link="https://www.oreilly.com/library/view/head-first-design/0596007124/",width=40%]
=====
endif::[]

ifdef::uk[]
In the following, every time you'll see à `fix #...` text, 
make sure all your files are committed, and then push your modifications in the distant repo, making sure you used the corresponding message (`fix #...`) in one of the `commit` messages.

[TIP]
====
- If you want to check that you're really ready for `fix #0`, you can run the command in your shell: `make check`.
- If you want to list the ToDos of the day, run `make todos`.
====

[NOTE]
=====
This TD exercise is inspired from the excellent https://www.oreilly.com/library/view/head-first-design/0596007124/[book]: "Head First: Design Pattern.
Bert Bates, Eric Freeman, Elisabeth Freeman, Kathy Sierra. Editions O'Reilly. 2005."

image::headFirst.jpg[link="https://www.oreilly.com/library/view/head-first-design/0596007124/",width=40%]
=====
endif::[]

//------------------------------------ 
//------------------------------------ 
//------------  Let's START----------- 
//------------------------------------ 
//------------------------------------ 


:numbered:
//------------------------------------ 
== Différences entre dépendance, association, composition, agrégation

Soit le diagramme de classe partiel suivant :

.Diagramme de classe partiel
image::assoc1.svg[]

//----------------------------- Question ------------------
.*QUESTION*
[WARNING]
====
Complétez en ajoutant les relations (dépendance, association,
	composition, agrégation) entre les classes.
====

//----------------------------------------------------- Correction -------------------------
ifdef::prof[]
[CAUTION]
========
.Class Diagramme de classe avec relations
image::assoc1-cor.svg[]	
========
endif::prof[]

ifndef::backend-pdf[.pass:[<i class="fa fa-github"></i>] commit/push]
ifdef::backend-pdf[.icon:github[] commit/push]
[source,shell]
....
fix #1.0 Completed class diagram
....

== Patrons

//----------------------------- Question ------------------
.*QUESTION*
[WARNING]
====
Pour chacun des diagrammes de classe partiels suivants (représentant
des patrons que vous connaissez), complétez :

- le nom du patron dans la légende,
- en ajoutant les relations.

.Patron ...
image::fabrique-c.svg[]

//.Patron ...
//image::etat-c.g[]

//.Patron ...
//image::observateur-c.png[]

.Patron ...
image::strategy-c.svg[]

====

== Machines à état

//----------------------------- Question ------------------
.*QUESTION*
[WARNING]
====
. Dessinez le diagramme d’états correspondant aux feux tricolores (en France)
classiques. Ajoutez la prise en compte de la panne dans un 2ème temps.
. Dessinez le diagramme d’états correspondant au déroulement d’une partie
d’échecs.
====
//----------------------------------------------------- Correction -------------------------
ifdef::prof[]
[CAUTION]
========
. Feu tricolore
+
.Diagramme d'état d'un feu tricolore classique
image::feu1.png[]
+
.Diagramme d'état d'un feu tricolore avec panne
image::feu2.png[]
. Echecs
+
.State machine of Chess Game
image::chess.svg[]
+

========
endif::prof[]

//----------------------------- Question ------------------
.*QUESTION*
[WARNING]
====
. Commit&Push when everything is ready
+
ifndef::backend-pdf[.pass:[<i class="fa fa-github"></i>] commit/push]
ifdef::backend-pdf[.icon:github[] commit/push]
[source,shell]
....
fix #2: State Machines...
....
+
====

== Diagrammes de séquences

Vous devez documenter, à partir des extraits de codes {java} suivants,
l'application `ApplicationBanque`, développée en S2.


NOTE: Vous refactorerez cette application en TP, l'objectif n'est donc pas
pour l'instant de remédier aux problèmes de conception mais plutôt de les
identifier.

.Méthode statique `comptesDUnPropretaire` (`ApplicationAgenceBancaire.java`)
[source,java]
-------
public static void comptesDUnPropretaire (AgenceBancaire ag, String nomProprietaire) {
	Compte []  t;

	t = ag.getComptesDe(nomProprietaire);
	if (t.length == 0) {
		System.out.println("pas de compte à ce nom ...");
	} else {
		System.out.println("  " + t.length + " comptes pour " + nomProprietaire);
		for (int i=0; i<t.length; i++)
			t[i].afficher();
	}
}
-------


//----------------------------- Question ------------------
.*QUESTION*
[WARNING]
====
Réalisez un diagramme de séquence illustrant le fonctionnement de cette
méthode.
====

.Extrait de `AccesAgenceBancaire.java`
[source,java]
-------
public class ApplicationAgenceBancaire {

	public static void main(String argv[]) {

		String choix;

		boolean continuer ;
		Scanner lect;
		AgenceBancaire monAg ;

		String nom, numero;
		Compte c;
		double montant;

		lect = new Scanner ( System.in );
		lect.useLocale(Locale.US);

		monAg = AccesAgenceBancaire.getAgenceBancaire();

		continuer = true;
		while (continuer) {
			...
			choix = lect.next();
			choix = choix.toLowerCase();
			switch (choix) {
				case "q" :
				System.out.println("ByeBye");
				continuer = false;
				break;
				case "l" :
				monAg.afficher();
				break;
				case "v" :
				System.out.print("Num compte -> ");
				numero = lect.next();
				c = monAg.getCompte(numero);
				if (c==null) {
					System.out.println("Compte inexistant ...");
				} else {
					c.afficher();
				}
				break;
				case "p" :
				System.out.print("Propriétaire -> ");
				nom = lect.next();
				ApplicationAgenceBancaire.comptesDUnPropretaire (monAg, nom);
				break;
				case "d" :
				...
				break;
				case "r" :
				...
				break;
				default :
				...
				break;
			}
		}
	}

	public static void comptesDUnPropretaire (AgenceBancaire ag,
		String nomProprietaire) {...}

	public static void deposerSurUnCompte (AgenceBancaire ag,
		String numeroCompte, double montant) {...}

	public static void retirerSurUnCompte (AgenceBancaire ag,
		String numeroCompte, double montant) {...}
}
-------

.Extrait de `AccesAgenceBancaire`
[source,java]
------
public class AccesAgenceBancaire {

	private AccesAgenceBancaire () {}
	public static AgenceBancaire getAgenceBancaire () {

		AgenceBancaire ag = new AgenceBancaire("CAISSE ECUREUIL", "PIBRAC");
		...
	}
...
}
------

//----------------------------------------------------- Correction -------------------------
ifdef::prof[]
.Solution image:icons/solution.png[]
[CAUTION]
========
.Sequence Diagram de la méthode `accountsOfOwner`
image::banque-seq-methode.png[]
========
endif::prof[]

//----------------------------- Question ------------------
.*QUESTION*
[WARNING]
====
. Commit&Push when everything is ready
+
ifndef::backend-pdf[.pass:[<i class="fa fa-github"></i>] commit/push]
ifdef::backend-pdf[.icon:github[] commit/push]
[source,shell]
....
fix #3: Sequence diagram...
....
+
====





//------------------------------------ 
//------------------------------------ 
//------------  Still Angry ---------- 
//------------------------------------ 
//------------------------------------ 

:numbered!:
[appendix]
== {allerPlusLoin}

//----------------------------- Question ------------------
.*QUESTION*
[WARNING]
====
. Réalisez le diagramme de classe de l'application
. Que vous rappelle la classe `AccesAgenceBancaire`?
. Réalisez un diagramme de séquence illustrant le fonctionnement de cette
application (`main`). On utilisera des blocs "ref" pour les appels aux méthodes
statiques, et on ne s'occupera pas des scanners.
. Peut-on, dans un code {java}, faire la différence entre
agrégation `+1 <>-> *+` et association `+1 -> *+`?
. Commit&Push when everything is ready
+
ifndef::backend-pdf[.pass:[<i class="fa fa-github"></i>] commit/push]
ifdef::backend-pdf[.icon:github[] commit/push]
[source,shell]
....
fix #Bonus: Here is additional material...
....
+
====

ifndef::compact[]
//------------------------------------ 
== {contrib}
//------------------------------------ 

- mailto:jbruel@gmail.com[Jean-Michel Bruel]

== {about}

****************************************************************
Baked with {asciidoctorlink} (version `{asciidoctor-version}`) from 'Dan Allen', based on {asciidoc}.
'Licence Creative Commons'.
image:88x31.png["Licence Creative
Commons",style="border-width:0",link="http://creativecommons.org/licenses/by-sa/3.0/"]
http://creativecommons.org/licenses/by-sa/3.0/[licence Creative Commons Paternité - Partage à l&#39;Identique 3.0 non transposé].
****************************************************************
endif::[]
